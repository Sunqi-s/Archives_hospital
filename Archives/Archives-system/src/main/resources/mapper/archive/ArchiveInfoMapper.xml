<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.archives.archive.mapper.ArchiveInfoMapper">

    <resultMap type="ArchiveInfo" id="ArchiveInfoResult">
        <result property="id"    column="id"    />
        <result property="categoryId"    column="category_id"    />
        <result property="fondsNumber"    column="fonds_number"    />
        <result property="fondsName"    column="fonds_name"    />
        <result property="retentionPeriod"    column="retention_period"    />
        <result property="itemNumber"    column="item_number"    />
        <result property="archiveNumber"    column="archive_number"    />
        <result property="department"    column="department"    />
        <result property="archiver"    column="archiver"    />
        <result property="archiveDate"    column="archive_date"    />
        <result property="remarks"    column="remarks"    />
        <result property="archiveStatus"    column="archive_status"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="categoryCode"    column="category_code"    />
        <result property="field1"    column="field1"    />
        <result property="field2"    column="field2"    />
        <result property="field3"    column="field3"    />
        <result property="field4"    column="field4"    />
        <result property="field5"    column="field5"    />
        <result property="field6"    column="field6"    />
        <result property="field7"    column="field7"    />
        <result property="field8"    column="field8"    />
        <result property="field9"    column="field9"    />
        <result property="field10"    column="field10"    />
        <result property="field11"    column="field11"    />
        <result property="field12"    column="field12"    />
        <result property="field13"    column="field13"    />
        <result property="field14"    column="field14"    />
        <result property="field15"    column="field15"    />
        <result property="field16"    column="field16"    />
        <result property="field17"    column="field17"    />
        <result property="field18"    column="field18"    />
        <result property="field19"    column="field19"    />
        <result property="field20"    column="field20"    />
        <result property="field21"    column="field21"    />
        <result property="field22"    column="field22"    />
        <result property="field23"    column="field23"    />
        <result property="field24"    column="field24"    />
        <result property="field25"    column="field25"    />
        <result property="field26"    column="field26"    />
        <result property="field27"    column="field27"    />
        <result property="field28"    column="field28"    />
        <result property="field29"    column="field29"    />
        <result property="field30"    column="field30"    />
        <result property="ossStatus"  column="oss_status" />
    </resultMap>

    <sql id="selectArchiveInfoVo">
        select id, category_id, fonds_number, fonds_name, retention_period, item_number, archive_number, department, archiver, archive_date, remarks, archive_status, create_by, create_time, update_by, update_time, category_code, field1, field2, field3, field4, field5, field6, field7, field8, field9, field10, field11, field12, field13, field14, field15, field16, field17, field18, field19, field20, field21, field22, field23, field24, field25, field26, field27, field28, field29, field30, oss_status from archive_info
    </sql>

    <select id="selectArchiveInfoList" parameterType="ArchiveInfo" resultMap="ArchiveInfoResult">
        <include refid="selectArchiveInfoVo"/>
        <where>
            <if test="categoryId != null "> and category_id = #{categoryId}</if>
            <if test="fondsNumber != null  and fondsNumber != ''"> and fonds_number = #{fondsNumber}</if>
            <if test="fondsName != null  and fondsName != ''"> and fonds_name like concat('%', #{fondsName}, '%')</if>
            <if test="retentionPeriod != null  and retentionPeriod != ''"> and retention_period = #{retentionPeriod}</if>
            <if test="itemNumber != null  and itemNumber != ''"> and item_number = #{itemNumber}</if>
            <if test="archiveNumber != null  and archiveNumber != ''"> and archive_number = #{archiveNumber}</if>
            <if test="department != null  and department != ''"> and department = #{department}</if>
            <if test="archiver != null  and archiver != ''"> and archiver = #{archiver}</if>
            <if test="archiveDate != null "> and archive_date = #{archiveDate}</if>
            <if test="remarks != null  and remarks != ''"> and remarks = #{remarks}</if>
            <if test="archiveStatus != null "> and archive_status = #{archiveStatus}</if>
            <if test="categoryCode != null  and categoryCode != ''"> and category_code = #{categoryCode}</if>
            <if test="field1 != null  and field1 != ''"> and field1 = #{field1}</if>
            <if test="field2 != null  and field2 != ''"> and field2 = #{field2}</if>
            <if test="field3 != null  and field3 != ''"> and field3 = #{field3}</if>
            <if test="field4 != null  and field4 != ''"> and field4 = #{field4}</if>
            <if test="field5 != null  and field5 != ''"> and field5 = #{field5}</if>
            <if test="field6 != null  and field6 != ''"> and field6 = #{field6}</if>
            <if test="field7 != null  and field7 != ''"> and field7 = #{field7}</if>
            <if test="field8 != null  and field8 != ''"> and field8 = #{field8}</if>
            <if test="field9 != null  and field9 != ''"> and field9 = #{field9}</if>
            <if test="field10 != null  and field10 != ''"> and field10 = #{field10}</if>
            <if test="field11 != null  and field11 != ''"> and field11 = #{field11}</if>
            <if test="field12 != null  and field12 != ''"> and field12 = #{field12}</if>
            <if test="field13 != null  and field13 != ''"> and field13 = #{field13}</if>
            <if test="field14 != null  and field14 != ''"> and field14 = #{field14}</if>
            <if test="field15 != null  and field15 != ''"> and field15 = #{field15}</if>
            <if test="field16 != null  and field16 != ''"> and field16 = #{field16}</if>
            <if test="field17 != null  and field17 != ''"> and field17 = #{field17}</if>
            <if test="field18 != null  and field18 != ''"> and field18 = #{field18}</if>
            <if test="field19 != null  and field19 != ''"> and field19 = #{field19}</if>
            <if test="field20 != null  and field20 != ''"> and field20 = #{field20}</if>
            <if test="field21 != null  and field21 != ''"> and field21 = #{field21}</if>
            <if test="field22 != null  and field22 != ''"> and field22 = #{field22}</if>
            <if test="field23 != null  and field23 != ''"> and field23 = #{field23}</if>
            <if test="field24 != null  and field24 != ''"> and field24 = #{field24}</if>
            <if test="field25 != null  and field25 != ''"> and field25 = #{field25}</if>
            <if test="field26 != null  and field26 != ''"> and field26 = #{field26}</if>
            <if test="field27 != null  and field27 != ''"> and field27 = #{field27}</if>
            <if test="field28 != null  and field28 != ''"> and field28 = #{field28}</if>
            <if test="field29 != null  and field29 != ''"> and field29 = #{field29}</if>
            <if test="field30 != null  and field30 != ''"> and field30 = #{field30}</if>
            <if test="ossStatus != null and ossStatus != ''">and oss_status = #{ossStatus}</if>
        </where>
        <choose>
            <when test="archiveStatus != 1">
                ORDER BY id DESC
            </when>
            <otherwise>
                ORDER BY archive_date DESC
            </otherwise>
        </choose>
    </select>

    <select id="selectArchiveInfoListByKeyword" parameterType="ArchiveInfo" resultMap="ArchiveInfoResult">
        <include refid="selectArchiveInfoVo"/>
        <where>
        and CONCAT_WS('|',
                        fonds_number,
                        fonds_name,
                        retention_period,
                        item_number,
                        archive_number,
                        department,
                        archiver,
                        remarks,
                        archive_status,
                        create_by,
                        update_by,
                        field1,
                        field2,
                        field3,
                        field4,
                        field5,
                        field6,
                        field7,
                        field8,
                        field9,
                        field10,
                        field11,
                        field12,
                        field13,
                        field14,
                        field15,
                        field16,
                        field17,
                        field18,
                        field19,
                        field20,
                        field21,
                        field22,
                        field23,
                        field24,
                        field25,
                        field26,
                        field27,
                        field28,
                        field29,
                        field30,
                        oss_status
                  ) LIKE CONCAT('%', #{searchValue}, '%')
        </where>
    </select>

    <select id="selectArchiveInfoById" parameterType="Long" resultMap="ArchiveInfoResult">
        <include refid="selectArchiveInfoVo"/>
        where id = #{id}
    </select>

    <insert id="insertArchiveInfo" parameterType="ArchiveInfo" useGeneratedKeys="true" keyProperty="id">
        insert into archive_info
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="categoryId != null">category_id,</if>
            <if test="fondsNumber != null and fondsNumber != ''">fonds_number,</if>
            <if test="fondsName != null and fondsName != ''">fonds_name,</if>
            <if test="retentionPeriod != null and retentionPeriod != ''">retention_period,</if>
            <if test="itemNumber != null and itemNumber != ''">item_number,</if>
            <if test="archiveNumber != null and archiveNumber != ''">archive_number,</if>
            <if test="department != null and department != ''">department,</if>
            <if test="archiver != null and archiver != ''">archiver,</if>
            <if test="archiveDate != null">archive_date,</if>
            <if test="remarks != null">remarks,</if>
            <if test="archiveStatus != null">archive_status,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="categoryCode != null and categoryCode != ''">category_code,</if>
            <if test="field1 != null">field1,</if>
            <if test="field2 != null">field2,</if>
            <if test="field3 != null">field3,</if>
            <if test="field4 != null">field4,</if>
            <if test="field5 != null">field5,</if>
            <if test="field6 != null">field6,</if>
            <if test="field7 != null">field7,</if>
            <if test="field8 != null">field8,</if>
            <if test="field9 != null">field9,</if>
            <if test="field10 != null">field10,</if>
            <if test="field11 != null">field11,</if>
            <if test="field12 != null">field12,</if>
            <if test="field13 != null">field13,</if>
            <if test="field14 != null">field14,</if>
            <if test="field15 != null">field15,</if>
            <if test="field16 != null">field16,</if>
            <if test="field17 != null">field17,</if>
            <if test="field18 != null">field18,</if>
            <if test="field19 != null">field19,</if>
            <if test="field20 != null">field20,</if>
            <if test="field21 != null">field21,</if>
            <if test="field22 != null">field22,</if>
            <if test="field23 != null">field23,</if>
            <if test="field24 != null">field24,</if>
            <if test="field25 != null">field25,</if>
            <if test="field26 != null">field26,</if>
            <if test="field27 != null">field27,</if>
            <if test="field28 != null">field28,</if>
            <if test="field29 != null">field29,</if>
            <if test="field30 != null">field30,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="categoryId != null">#{categoryId},</if>
            <if test="fondsNumber != null and fondsNumber != ''">#{fondsNumber},</if>
            <if test="fondsName != null and fondsName != ''">#{fondsName},</if>
            <if test="retentionPeriod != null and retentionPeriod != ''">#{retentionPeriod},</if>
            <if test="itemNumber != null and itemNumber != ''">#{itemNumber},</if>
            <if test="archiveNumber != null and archiveNumber != ''">#{archiveNumber},</if>
            <if test="department != null and department != ''">#{department},</if>
            <if test="archiver != null and archiver != ''">#{archiver},</if>
            <if test="archiveDate != null">#{archiveDate},</if>
            <if test="remarks != null">#{remarks},</if>
            <if test="archiveStatus != null">#{archiveStatus},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="categoryCode != null and categoryCode != ''">#{categoryCode},</if>
            <if test="field1 != null">#{field1},</if>
            <if test="field2 != null">#{field2},</if>
            <if test="field3 != null">#{field3},</if>
            <if test="field4 != null">#{field4},</if>
            <if test="field5 != null">#{field5},</if>
            <if test="field6 != null">#{field6},</if>
            <if test="field7 != null">#{field7},</if>
            <if test="field8 != null">#{field8},</if>
            <if test="field9 != null">#{field9},</if>
            <if test="field10 != null">#{field10},</if>
            <if test="field11 != null">#{field11},</if>
            <if test="field12 != null">#{field12},</if>
            <if test="field13 != null">#{field13},</if>
            <if test="field14 != null">#{field14},</if>
            <if test="field15 != null">#{field15},</if>
            <if test="field16 != null">#{field16},</if>
            <if test="field17 != null">#{field17},</if>
            <if test="field18 != null">#{field18},</if>
            <if test="field19 != null">#{field19},</if>
            <if test="field20 != null">#{field20},</if>
            <if test="field21 != null">#{field21},</if>
            <if test="field22 != null">#{field22},</if>
            <if test="field23 != null">#{field23},</if>
            <if test="field24 != null">#{field24},</if>
            <if test="field25 != null">#{field25},</if>
            <if test="field26 != null">#{field26},</if>
            <if test="field27 != null">#{field27},</if>
            <if test="field28 != null">#{field28},</if>
            <if test="field29 != null">#{field29},</if>
            <if test="field30 != null">#{field30},</if>
        </trim>
    </insert>

    <insert id="insertArchiveInfoList" parameterType="java.util.List">
        INSERT INTO archive_info (
        category_id, fonds_number, fonds_name, retention_period, item_number, archive_number, department, archiver, archive_date, archive_status, category_code, field1, field2, field3, field4, field5, field6, field7, field9, field10, field11, field12, field13, field14, field15, field16, field17, field18, field19, field20, field21, field24, field25, field26, field27, field28, field29, field30
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.categoryId}, #{item.fondsNumber}, #{item.fondsName}, #{item.retentionPeriod}, #{item.itemNumber}, #{item.archiveNumber}, #{item.department}, #{item.archiver}, #{item.archiveDate}, #{item.archiveStatus}, #{item.categoryCode}, #{item.field1}, #{item.field2}, #{item.field3}, #{item.field4}, #{item.field5}, #{item.field6}, #{item.field7}, #{item.field9}, #{item.field10}, #{item.field11}, #{item.field12}, #{item.field13}, #{item.field14}, #{item.field15}, #{item.field16}, #{item.field17}, #{item.field18}, #{item.field19}, #{item.field20}, #{item.field21}, #{item.field24}, #{item.field25}, #{item.field26}, #{item.field27}, #{item.field28}, #{item.field29}, #{item.field30}
            )
        </foreach>
    </insert>

    <update id="insertOssStatus">
        update archive_info set oss_status = #{ossStatus} where id = #{id}
    </update>


    <update id="updateArchiveInfo" parameterType="ArchiveInfo">
        update archive_info
        <trim prefix="SET" suffixOverrides=",">
            <if test="categoryId != null">category_id = #{categoryId},</if>
            <if test="fondsNumber != null and fondsNumber != ''">fonds_number = #{fondsNumber},</if>
            <if test="fondsName != null and fondsName != ''">fonds_name = #{fondsName},</if>
            <if test="retentionPeriod != null and retentionPeriod != ''">retention_period = #{retentionPeriod},</if>
            <if test="itemNumber != null and itemNumber != ''">item_number = #{itemNumber},</if>
            <if test="archiveNumber != null and archiveNumber != ''">archive_number = #{archiveNumber},</if>
            <if test="department != null and department != ''">department = #{department},</if>
            <if test="archiver != null and archiver != ''">archiver = #{archiver},</if>
            <if test="archiveDate != null">archive_date = #{archiveDate},</if>
            <if test="remarks != null">remarks = #{remarks},</if>
            <if test="archiveStatus != null">archive_status = #{archiveStatus},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="categoryCode != null and categoryCode != ''">category_code = #{categoryCode},</if>
            <if test="field1 != null">field1 = #{field1},</if>
            <if test="field2 != null">field2 = #{field2},</if>
            <if test="field3 != null">field3 = #{field3},</if>
            <if test="field4 != null">field4 = #{field4},</if>
            <if test="field5 != null">field5 = #{field5},</if>
            <if test="field6 != null">field6 = #{field6},</if>
            <if test="field7 != null">field7 = #{field7},</if>
            <if test="field8 != null">field8 = #{field8},</if>
            <if test="field9 != null">field9 = #{field9},</if>
            <if test="field10 != null">field10 = #{field10},</if>
            <if test="field11 != null">field11 = #{field11},</if>
            <if test="field12 != null">field12 = #{field12},</if>
            <if test="field13 != null">field13 = #{field13},</if>
            <if test="field14 != null">field14 = #{field14},</if>
            <if test="field15 != null">field15 = #{field15},</if>
            <if test="field16 != null">field16 = #{field16},</if>
            <if test="field17 != null">field17 = #{field17},</if>
            <if test="field18 != null">field18 = #{field18},</if>
            <if test="field19 != null">field19 = #{field19},</if>
            <if test="field20 != null">field20 = #{field20},</if>
            <if test="field21 != null">field21 = #{field21},</if>
            <if test="field22 != null">field22 = #{field22},</if>
            <if test="field23 != null">field23 = #{field23},</if>
            <if test="field24 != null">field24 = #{field24},</if>
            <if test="field25 != null">field25 = #{field25},</if>
            <if test="field26 != null">field26 = #{field26},</if>
            <if test="field27 != null">field27 = #{field27},</if>
            <if test="field28 != null">field28 = #{field28},</if>
            <if test="field29 != null">field29 = #{field29},</if>
            <if test="field30 != null">field30 = #{field30},</if>
            <if test="ossStatus != null">oss_status = #{ossStatus},</if>
        </trim>
        where id = #{id}
    </update>

    <update id="updateArchiveStatusById" parameterType="Long">
        update archive_info set archive_status = 1 where id = #{id}
    </update>

    <update id="updateArchiveStatusByIds">
        UPDATE archive_info
        SET
        archive_date = CASE
        WHEN archive_status = 0 THEN NOW() -- 修改归档时间
        ELSE archive_date -- 保持原值
        END,
        archive_status = CASE
        WHEN archive_status = 0 THEN 1
        WHEN archive_status = 1 THEN 0
        ELSE archive_status -- 不是0或1，保持原值
        END
        WHERE id IN
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <delete id="deleteArchiveInfoById" parameterType="Long">
        delete from archive_info where id = #{id}
    </delete>

    <delete id="deleteArchiveInfoByIds" parameterType="String">
        delete from archive_info where id in
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper>
